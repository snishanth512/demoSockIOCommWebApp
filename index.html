<!doctype html>
<html>

<head>
  <title>Message from Server</title>
</head>
<style>
  .clTable {
    table-layout: fixed;
    border-collapse: collapse;
    border: 2px solid black;
  }

  .clTable td,
  .clTable th {
    padding: 10px;
    border: 1px solid black;
  }
  .clTable {
    width: 100%;
  }

  body {
    font-family: sans-serif;
  }

  .container {
    width: 100%;
    height: 50%;
  }
</style>

<body>
  <div>
  <table id="msgTableId" class="clTable" align="left">
    <tr>
      <td rowspan="7">
        Redirect Links
      </td>
      <td>
        <form action="">
          topic <input id="m" autocomplete="off" /> <button>Send</button>
        </form>
      </td>
    </tr>
    <tr>
      <th align="left">
        Message Received
      </th>
    </tr>
  </table>
  </div>
  <br>
  <div>
      <p> sample text </p>
  </div>
  
  <div class="container">
      <canvas id="plot2dId"></canvas>
    </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/jquery/jquery.js"></script>
  <script src="/chart.js/chart.js"></script>
  <script>
    function renderChart(data, labels) {
      var ctx = document.getElementById("plot2dId").getContext('2d');
      var myChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'This week',
            data: data,
          }]
        },
      });
    }
    $(function () {
      var socket = io();
      var msgCount = 0;
      var viewTable = document.getElementById("msgTableId");
      var row;
      var cell = [], msgCells = [];
      cell.length = 5;

      $('form').submit(function (e) {
        e.preventDefault();
        socket.emit('browserMessage', $('#m').val());
        $('#m').val('');
        return false;
      });

      for (var index = 0; index < cell.length; index++) {
        row = viewTable.insertRow(-1);
        cell[index] = row.insertCell(0);
      }

      socket.on('browserMessage', function (msg) {
        cell[msgCount].innerHTML = msg;
        data = [];
        data.length=7;
        for (var index=0; index< data.length; index++){
          data[index] = Math.random();
        }
      labels = ["sunday", "monday", "tuesday", "wednesday", "thursday", "friday", "saturday"];
      renderChart(data, labels);
        msgCount++;
        if (msgCount >= cell.length) {
          msgCount = msgCount % cell.length;
        }
      });
    });
  </script>
</body>

</html>